server {
  listen <%= @port %>;
  server_name <%= @server_name %>;

  ssl on;
  ssl_certificate <%= @ssl_certificate %>;
  ssl_certificate_key <%= @ssl_certificate_key %>;

  ssl_session_timeout 5m;

  ssl_protocols <%= @ssl_protocols %>;
  ssl_ciphers <%= @ssl_ciphers %>;
  ssl_prefer_server_ciphers on;

  client_max_body_size <%= @client_max_body_size %>;

  access_log /var/log/opscode/nginx/webui2.access.log opscode;
  error_log /var/log/opscode/nginx/webui2.error.log debug;

  proxy_set_header        Host            $host;
  proxy_set_header        X-Real-IP       $remote_addr;
  proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
  proxy_set_header        X-Forwarded-Proto https;
  proxy_pass_request_headers on;
  proxy_connect_timeout   300;
  proxy_send_timeout      300;
  proxy_read_timeout      300;

  location ~ ^/_events(/status)?$ {
    proxy_pass http://opscode_webui2-events;
    proxy_pass_header Server;
    proxy_buffering off;
  }

  location / {
    proxy_pass http://opscode_webui2;
  }
}
